name: resume_templates_pr
on:
  pull_request:
    branches:
      - main
    # only checking directories with .tex files
    paths:
      - 'career_developer_template/**'
      - 'general_template/**'
      - 'junior_developer_template/**'
      - 'cover_letter/**'
      - 'references/**'

jobs:
  compile_check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: install LaTeX distribution
        run: |
          sudo apt update
          sudo apt-get install --no-install-recommends texlive-xetex texlive-fonts-recommended texlive-plain-generic 
      - name: download font dependencies
        run: |
          curl "https://mirror.quantum5.ca/CTAN/fonts/tex-gyre.zip" -O
      - name: install font dependencies
        run: |
          unzip tex-gyre.zip -d fonts
          mkdir -p ~/.local/share/fonts
          cp fonts/*.ttf ~/.local/share/fonts/
          cp fonts/*.otf ~/.local/share/fonts/
          fc-cache -f -v
          fc-list | grep "gyre"
      - name: compile career developer template
        run: |
          xelatex career_developer_template/main.tex
          if [ $? -ne 0 ]; then
              echo "::error::xelatex compilation failed for career_developer_template/main.tex!"
              exit 1
          fi
      - name: compile general template
        run: |
          xelatex general_template/main.tex
          if [ $? -ne 0 ]; then
              echo "::error::xelatex compilation failed for general_template/main.tex!"
              exit 1
          fi
        
      - name: compile junior developer template
        run: |
          xelatex junior_developer_template/main.tex
          if [ $? -ne 0 ]; then
              echo "::error::xelatex compilation failed for junior_developer_template/main.tex!"
              exit 1
          fi
        
      - name: compile cover letter
        run: |
          xelatex cover_letter/main.tex
          if [ $? -ne 0 ]; then
              echo "::error::xelatex compilation failed for cover_letter/main.tex!"
              exit 1
          fi
        
      - name: compile references
        run: |
          xelatex references/main.tex
          if [ $? -ne 0 ]; then
              echo "::error::xelatex compilation failed for references/main.tex!"
              exit 1
          fi